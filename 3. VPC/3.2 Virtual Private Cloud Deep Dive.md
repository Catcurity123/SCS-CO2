#### A. DHCP in a VPC
(+) Dynamic Host Configuration Protocol (DHCP) for auto configuration of network resources.
(+) Starts with L2 broadcast to get info from DHCP server.
(+) `DHCP Option Sets`: cannot be edited - once created, they're immutable, it can be associated with 0 or more VPCs
![[Pasted image 20240819164336.png]]

#### B. VPC Router Deep Dive
(+) Virtual Router within a VPC
(+) `Highly Available` - across all AZs in that region
(+) `No management overhead`, as it is automatically configure by AWS
(+) `Scalable` - no performance management required
(+) `Routes` `traffic` `between` `subnet`.
(+) Controlled using route tables
==> Interface in every subnet in `subnet + 1` address.

![[Pasted image 20240819165637.png]]

(+) Every VPC is created with a `main route table (MRT)`, and it is default for every subnet in the VPC
(+) Custom route tables can be created and associated with subnets in the VPC - removing the association with the `MRT`.

#### C. Internet Gateway (IGW) Deep Dive
(+) `1 to 1` relationship, `1 IGW` per `VPC`, `1 VPC` per `IGW`
(+) Architecturally at the VPC & AWS Public Zone border.
(+) It is used to access `AWS Public Services` and `Public Internet`.
(+) `Highly available` by default and `scales` by default

![[Pasted image 20240819180710.png]]

![[Pasted image 20240819180735.png]]

###### C1. Egress-Only Internet Gateway
(+) With IPv4 addresses are private or public
(+) `NAT` allows `private IPs` to access `public networks`, without allowing externally initiated connections
(+) With IPv5 all IPs are Public, therefore, Internet Gateway allows all IPs `In` and `Out`
===> We need a service to connect the IPv6 `Out` (and response `IN`), but not `externally initiated IN connection`.

![[Pasted image 20240819181128.png]]


#### D. NAT Deep Dive

###### D1. NAT Instance
(+) NAT Software running on an EC2 Instance, it is end of life and recommended to move to NATGW.
(+) The speed is based on `size` and `type` of EC2 instance.

![[Pasted image 20240819181612.png]]

###### D2. Nat Gateway
![[Pasted image 20240819181857.png]]

#### E. AWS PrivateLink
(+) AWS PrivateLink allows application in a private subnet of VPC to connect to a service which is not in current VPC without leaving the AWS network.
==> Â VPC peering allows us to do same but it establishes a connection with a scope which is too big. Also peering does have a restriction of non-overlapping CIDR
==> `AWS PrivateLink` allows access to the `service` not the `VPC`.

![[Pasted image 20240819184307.png]]

###### E1. AWS PrivateLink and AWS VPC Endpoint (Gateway)
###### **AWS PrivateLink**:
(+) **Overview**: AWS PrivateLink is a service that allows you to access AWS services (like Amazon S3, DynamoDB) or your own services hosted on AWS privately, over a private network connection.
(+) **How It Works**: It uses VPC Endpoint Interface to provide private connectivity between VPCs or between VPCs and on-premises networks without exposing traffic to the public internet.
(+) **Use Case**: Ideal for accessing services across different VPCs or from on-premises to VPC securely.

###### **VPC Endpoint Gateway**:
(+) **Overview**: A VPC Endpoint Gateway is a specific type of VPC endpoint that allows you to connect to certain AWS services, specifically Amazon S3 and DynamoDB, from your VPC using a private network connection.
(+) **How It Works**: When you create a VPC Endpoint Gateway, it adds an entry to your route table, directing traffic destined for the service (like S3 or DynamoDB) through the gateway.
(+) **Use Case**: Useful when you want to access S3 or DynamoDB without using the internet gateway, ensuring that all traffic remains within the AWS network.

###### **VPC Endpoint Interface**:
(+) **Overview**: A VPC Endpoint Interface is a type of VPC endpoint that allows you to connect to many AWS services privately, over private IP addresses within your VPC. It is used in conjunction with AWS PrivateLink.
(+) **How It Works**: When you create a VPC Endpoint Interface, it creates an Elastic Network Interface (ENI) within your subnet, and traffic to the AWS service flows through this ENI.
(+)**Use Case**: Ideal for accessing services like EC2 APIs, SNS, CloudWatch, and many others from within your VPC securely and privately.

#### C. VPC Flow Logs
(+) Capture `metadata` (not contents), it is attached to a `VPC` and it will capture `ALL ENIs` in that `VPC`.
(+) If it is attached to a `Subnet`, it will capture `ALL ENIs` in that `Subnet`
(+) Flow logs are `NOT` real time.
(+) Log destinations can be `S3` or `CloudWatch` Logs, and we can use `Athena for querying` using SQL.

![[Pasted image 20240819171529.png]]

###### C1. VPC Flow Logs format
![[Pasted image 20240819171923.png]]

(+) The first log is accepted as the security group and NACL allows the inbound, the second log is rejected maybe because it is not allowed in the NACL, despite the SG is two-ways.

#### D. VPC Traffic Mirroring
(+) Copy network traffic from an Elastic Network Interface (ENI) from your EC2 instance into your VPCs and send it to the security and monitoring appliances. This is done for `Content inspection`, `Threat Monitoring`, `Troubleshooting`
(+) `Source`: A network interface with the type `instance`, `Target`: the destination for mirrored traffic.
(+) `Filter`: A set of rules that defines the traffic that is copied in a traffic mirror session
(+) `Session`: An entity that describes Trafic Monitoring from a source to a target using filter

![[Pasted image 20240819173346.png]]

![[Pasted image 20240819175718.png]]